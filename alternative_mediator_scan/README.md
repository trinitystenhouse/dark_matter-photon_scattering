# Alternative mediator scan

This folder contains a parameter scan over several toy/benchmark mediator models for DM–photon scattering, searching for parameter points that can produce a visible attenuation (“dip”) while remaining compatible with the Fermi-LAT spectrum at a chosen confidence level.

## Setup (recommended)

From the **repo root**:

```bash
source setup.sh
```

This:

- exports `REPO_PATH` (repo root)
- installs the top-level `helpers` package in editable mode

The scan scripts use `REPO_PATH` to locate input data under:

- `${REPO_PATH}/fermi_data/york/processed/spectrum_data.txt`

## Inputs

- Spectrum file:
  - `${REPO_PATH}/fermi_data/york/processed/spectrum_data.txt`
  - Generated by York processing pipeline in `York_paper_check/data_processing/`.

## Run all scans

```bash
bash run_all_scans.sh
```

This loops over a list of DM masses and runs scans for these mediators:

- `scalar`
- `pseudoscalar`
- `thomson`
- `rayleigh_even`
- `rayleigh_odd`
- `graviton`

## Output layout

`run_all_scans.sh` writes outputs under `alternative_mediator_scan/scans/`:

### Per-mass results (CSV/TXT)

- `scans/results/<mediator>/mchi<MCHI>/`

Contains files like:

- `scan_<mediator>_mchi<MCHI>.csv`
- `best_<mediator>_mchi<MCHI>.txt`
- `bestdeviant_<mediator>_mchi<MCHI>.txt`
- `firstdip_<mediator>_mchi<MCHI>.txt`

The Python scanner also writes an internal per-run plot directory:

- `scans/results/<mediator>/mchi<MCHI>/plots/`

### Consolidated plots (one folder per mediator)

All `.png` plots are copied into:

- `scans/plots/<mediator>/`

Filenames are prefixed with the mass tag (e.g. `mchi1e-3_...png`) to avoid collisions.

## Running a single scan manually

Example (scalar mediator):

```bash
python alternative_mediators_scan.py \
  --filename "${REPO_PATH}/fermi_data/york/processed/spectrum_data.txt" \
  --mchi 1 \
  --mediator scalar \
  --rho 1.2e-6 --L 12 --L_unit Gpc \
  --scan mmed=log:0.01:1e4:18 \
  --scan gchi=log:1e-3:3.5449077:16 \
  --scan cgamma=log:1e-10:1:18 \
  --dip_anywhere 0.01 \
  --pmin 0.01 \
  --pmin_model dm \
  --plot_best_deviant \
  --outdir "${REPO_PATH}/alternative_mediator_scan/scans/results/scalar/mchi1"
```

## Key CLI flags (alternative_mediators_scan.py)

- `--filename`: spectrum input file (defaults to `${REPO_PATH}/fermi_data/york/processed/spectrum_data.txt`)
- `--mchi`: DM mass [GeV]
- `--mediator`: one of the supported mediator models
- `--scan param=...`: add a scan axis
- `--dip_anywhere`: require at least this fractional dip somewhere in the band
- `--pmin`: require p-value >= pmin
- `--pmin_model`: which model to compute p-value for (`dm`, `forced`, `both`)
- `--plot_best_deviant`, `--plot_first_dip`, `--save_all_plots`: plot output controls
